var tinyshop={name:"tinyshop javascript library",version:"1.13",instanceid:1e5,messagecode:1e5,csp:["Access-Control-Allow-Origin","*"],xhr:function(){var e=null,t=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];try{e=new XMLHttpRequest}catch(i){for(var s=0;s<t.length;s++)try{e=new ActiveXObject(t[s])}catch(e){continue}}return e},message:function(e){window.alert(this.htmlspecialchars(e,"full")+"\n"+"-".repeat(32)+"\n#TS-MSGC-"+this.messagecode),this.messagecode<this.math("maxint")&&this.messagecode++},htmlspecialchars:function(e,t="full",s="utf-8"){switch(t){case"full":f=["<",">","!","$","%","'","(",")","*","+",":","=","`","{","}","[","]"],r=["&#60;","&#62;","&#34;","&#36;","&#37;","&#39;","&#40;","&#41;","&#42;","&#43;","&#58;","&#61;","&#96;","&#123;","&#125;","&#91;","&#93;"];break;case"uri":f=["<",">","'"],r=["&#60;","&#62;","&#39;"]}for(var i=0;i<f.length;i++)e=String(e).replace(f[i],r[i]);return e},duplicatearray:function(e,t){return e.length=0,e.push.apply(e,t),e},redirect:function(e,t=0){1==t?window.reload():document.location=e?tinyshop.htmlspecialchars(e,"uri"):tinyshop.htmlspecialchars(location.href,"uri")},math:function(e,t=1,s=1){switch(e){case"int":if(s>1)for(;s>0;)this.math("int",t,s),this.result=parseInt(t),s--;else this.result=parseInt(t);break;case"float":this.result=parseFloat(t);break;case"fixed":this.result=t.toFixed(s);break;case"rand":this.result=Math.random(1,Number.MAX_SAFE_INTEGER);break;case"maxint":this.result=Number.MAX_SAFE_INTEGER;break;case"uuid":this.result=Math.random().toString(16).slice(2,10)}return this.result},rnd:function(e="rand",t=null,s=null,i=null){switch(e){case"rand":this.r=Math.random(1,Number.MAX_SAFE_INTEGER);break;case"uuid":this.r=Math.random().toString(16).slice(2,14);break;case"bytes":this.r=Math.random()}return this.r},toggle:function(e,t){for(i=0;i<t;i++)try{this.dom("toggle"+e,"display","none"),this.dom("cat"+e,"fontWeight","100")}catch(e){}this.dom("toggle"+e,"display","block"),this.dom("cat"+e,"fontWeight","bold")},dom:function(e,t,s=""){try{if(e)switch(t){case"get":return document.getElementById(e).value;case"set":document.getElementById(escape(e)).value=this.htmlspecialchars(s,"full");break;case"html":document.getElementById(escape(e)).innerHTML=this.htmlspecialchars(s,"full");break;case"gethtml":document.getElementById(escape(e)).innerHTML;break;case"display":document.getElementById(escape(e)).style.display=this.htmlspecialchars(s,"full");break;case"fontWeight":case"className":document.getElementById(escape(e)).style.fontWeight=this.htmlspecialchars(s,"full")}else this.message("DOM constructor could not populate the requested action.")}catch(e){this.message(this.htmlspecialchars(e,"full"))}},returner:function(e){return window.alert(this.htmlspecialchars(e,"full")),this.htmlspecialchars(e,"full")},json:function(e){tinyshop.fetchJSON(e,function(e){return JSON.parse(e)})},caller:function(e,t,s=[],i=[],a){if("POST"==e){if(null!=i)var n="POST"}else n="GET";if(!a)switch(t){case"shipping":a="inventory/shipping.json";break;case"inventory":a="inventory/shop.json";break;case"settings":a="inventory/site.json";break;case"currencies":a="inventory/currencies.json";break;case"pages":a="inventory/pages.json";break;case"articles":a="inventory/articles.json";break;case"blog":a="inventory/blog.json";break;case"messages":a="inventory/messages.json";break;case"conf":a="inventory/shop.conf.json";break;case"cart":a="inventory/cart.json";break;case"customer":a="inventory/customer.json";break;case"orders":a="inventory/orders.json"}var r=t,o=tinyshop.xhr();o.onreadystatechange=function(){if(4==o.readyState)switch(r){case"inventory":tinyshop.getinventory(this.responseText);break;case"settings":tinyshop.getsettings(this.responseText);break;case"shipping":tinyshop.getshipping(this.responseText,s);break;case"shippinglist":tinyshop.getshippinglist(this.responseText);break;case"currencies":tinyshop.getcurrencies(this.responseText,s);break;case"pages":tinyshop.getpages(this.responseText,s);break;case"articles":tinyshop.getarticles(this.responseText,s);break;case"blog":tinyshop.getblog(this.responseText,s);break;case"messages":tinyshop.getmessages(this.responseText,s);break;case"conf":tinyshop.getconf(this.responseText,s);break;case"cart":tinyshop.getcart(this.responseText,s);break;case"customer":tinyshop.getcustomer(this.responseText,s);break;case"orders":tinyshop.getorders(this.responseText,s)}},o.open(n,a+"?cache-control="+this.instanceid,!0),o.withCredentials=!0,o.setRequestHeader("Access-Control-Allow-Origin","*"),"POST"==n?(o.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),o.send(JSON.stringify(i))):(o.setRequestHeader("Content-Type","application/json;charset=UTF-8"),o.send())},fetchJSON:function(e,t){var s=tinyshop.xhr();s.open("GET",e,!0),s.withCredentials=!0,s.setRequestHeader("Access-Control-Allow-Origin","*"),s.setRequestHeader("Content-Type","application/json;charset=UTF-8"),s.onreadystatechange=function(){4==s.readyState&&200==s.status&&t(s.responseText)},s.send(null)},fetchHTML:function(e,t,s=[],i,a=!1){var n=this.xhr();if("POST"==e){if(null!=s)var r="POST"}else r="GET";n.open(r,t,!0),n.withCredentials=!0,n.setRequestHeader("Access-Control-Allow-Origin","*"),"POST"==r?(n.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),n.send(s),n.onreadystatechange=function(){4==n.readyState&&200==n.status&&(this.res=n.responseText,i&&tinyshop.dom(i,"html",this.res),a&&tinyshop.redirect(a))}):(n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.send(null))},addtocart:function(e,t,s){if(!s)s="invalid";if(!(i=this.dom(t,"get"))||i.isNaN)var i=1;this.id=this.math("int",e,1),this.qty=this.math("int",i,1),this.fetchHTML("POST","/shop/cart/addtocart/"+this.instanceid+"/","action=addtocart&id="+this.id+"&qty="+this.qty+"&token="+s,"result")},deletefromcart:function(e,t){t||this.dom("result","Token was not set."),this.fetchHTML("POST","/shop/cart/delete/"+this.instanceid+"/","action=deletefromcart&id="+this.math("int",e)+"&token="+t,!1,"/shop/cart/")},updatecart:function(e,t,s){s||this.dom("result","Token was not set."),qty=t?this.dom(t,"get"):1,this.id=this.math("int",e,1),this.qty=this.math("int",qty,1),this.fetchHTML("POST","/shop/cart/update/"+this.instanceid+"/","action=updatecart&id="+this.id+"&qty="+this.qty+"&token="+s,!1,"/shop/cart/")},calculateTotalPayPal:function(e){var t=this.dom("item_price","get"),s=this.dom("shipping","get"),i=this.dom("handling","get"),a=(this.dom("total_amount","get"),this.math("int",this.math("int",s)+this.math("int",i))),n=this.math("int",t*e),r=this.math("int",this.math("int",a)+this.math("int",n));return this.dom("total_amount","set",r),!0},getsettings:function(e){var t,s=[];t=JSON.parse(e);for(var i=0;i<t.length;i++)for(var a in t[i])-1===s.indexOf(a)&&s.push(a);for(i=0;i<t.length;i++)for(var n=0;n<s.length;n++)""==t[i][s[n]]||null==t[i][s[n]]||(document.write(s[n]+":"),document.write(t[i][s[n]]),document.write("<br>"))},getinventory:function(e){var t,s=[];t=JSON.parse(e);for(var i=0;i<t.length;i++)for(var a in t[i])-1===s.indexOf(a)&&s.push(a);for(i=0;i<t.length;i++)for(var n=0;n<s.length;n++)""==t[i][s[n]]||null==t[i][s[n]]||(document.write(s[n]+":"),document.write(t[i][s[n]]),document.write("<br>"))},getshippinglist:function(e){var t,s=[],i='<select name="shippingcountry">';t=JSON.parse(e);for(var a=0;a<t.length;a++)for(var n in t[a])-1===s.indexOf(n)&&s.push(n);for(a=0;a<t.length;a++)for(var r=0;r<s.length;r++)i+='<option value="">'+s[r].replace("shipping.","")+"</option>";return i+="</select>"},getshipping:function(e,t){if(!1)this.message("Shipping country is not set, cannot calculate shipping cost.");else{var s,i=[],a=(this.htmlspecialchars(t[0],"full"),t[1]),n=this.htmlspecialchars(t[2],"full"),r=this.htmlspecialchars(t[3],"full"),o="shipping."+this.htmlspecialchars(n,"full");s=JSON.parse(!1);for(var h=0;h<s.length;h++)for(var c in s[h])-1===i.indexOf(c)&&i.push(c);for(h=0;h<s.length;h++)for(var l=0;l<i.length;l++)if(i[l]==o){var p=s[h][i[l]],u=this.math("float",a)+this.math("float",p);this.dom(r,"html","&euro;"+this.math("float",u,2))}}},wishlist:function(e,t,s){var i=this.xhr();i.open("GET","/wishlist/"+this.rnd()+"/"+e+"/"+this.htmlspecialchars(t,"full")+"&tr="+this.htmlspecialchars(s,"uri"),!0),i.onreadystatechange=function(){if(4==i.readyState&&200==i.status){var e=i.responseText.split("|");return"O"==e[0].replace(" ","")?("0"!=s?(tinyshop.dom("fhs"+t,"html",e[1]),tinyshop.dom("favheart"+t,"className","heartfull_png")):(tinyshop.dom("fhs"+t,"html",e[1]),tinyshop.dom("favheart"+t,"className","favheart_fixed")),!1):"X"==e[0].replace(" ","")&&("0"!=s?(tinyshop.dom("fhs"+t,"html",e[1]),tinyshop.dom("favheart"+t,"className","heart_png")):(tinyshop.dom("fhs"+t,"html",e[1]),tinyshop.dom("favheart"+t,"className","favheart")),!1)}},i.send(null)},redeemVoucher:function(){var e=this.dom("voucher","get");if(""==e)this.message("Please enter voucher code. This code is a sequence of numbers and letters.");else{var t=this.xhr();t.open("GET","/query/"+this.rnd()+"/voucher/"+this.htmlspecialchars(e)+"/",!0),t.onreadystatechange=function(){if(4==t.readyState&&200==t.status)if(t.responseText){var e=t.responseText.split("|");if("OK"==e[0].replace(" ","")){var s=this.dom("total","gethtml");s=s.replace("&euro;","").replace(/\u20ac/g,"").replace(",",".").replace(" ","");var i=this.math("float",s);if(""!=e[1])var a=e[1],n=i-this.math("float",a);else if(""!=e[2]&&"|"!=e[2])n=i-i/100*e[2];i<0?this.message("The amount is too tow to redeem the voucher."):"NaN"==n.toFixed(2)?this.dom("total","html","&euro;"+n):this.dom("total","html","&euro;"+n.toFixed(2))}else"ERR"==e[0].replace(" ","")?this.message("Code has already been redeemed, or is wrong."):this.message("There was a problem with redeeming the voucher code. Please check if the code is correct.")}else this.message("There was a problem with redeeming. Please check if the code is correct.")},t.send(null)}}};tinyshop.instanceid=tinyshop.rnd("uuid");
